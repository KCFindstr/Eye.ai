<!DOCTYPE html>
<html>

<head>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/2.9.6/jquery.fullpage.min.css" rel="stylesheet" type="text/css"
	/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
	<!-- <video id="video" width="640" height="480" autoplay></video> -->
	<!-- <button id="snap">Snap Photo</button> -->
	<input id="myFileInput" type="file" accept="image/*;capture=camera">
	<video id="player" controls autoplay></video>
	<button id="capture">Capture</button>
	<canvas id="snapshot" width=320 height=240></canvas>
	<button id="upload">Upload</button>
	<img id="frame">
	<script>
		var player = document.getElementById('player');
		var snapshotCanvas = document.getElementById('snapshot');
		var captureButton = document.getElementById('capture');
		var uploadButton = document.getElementById('upload');
		var videoTracks;

		var handleSuccess = function (stream) {
			// Attach the video stream to the video element and autoplay.
			player.srcObject = stream;
			videoTracks = stream.getVideoTracks();
		};

		captureButton.addEventListener('click', function () {
			var context = snapshot.getContext('2d');
			// Draw the video frame to the canvas.
			context.drawImage(player, 0, 0, snapshotCanvas.width,
				snapshotCanvas.height);
		});

		navigator.mediaDevices.getUserMedia({ video: true })
			.then(handleSuccess);

		uploadButton.addEventListener('click', function () {
			var dataurl = canvas.toDataURL('image/jpeg', 0.8);
			var blob = dataURLtoBlob(dataurl);
			//使用ajax发送
			var fd = new FormData();
			fd.append("image", blob, "image.jpeg");
			var xhr = new XMLHttpRequest();
			xhr.open('POST', '/', true);
			xhr.send(fd);
		}
	</script>
	<!--
	<script>
		// Put event listeners into place
		window.addEventListener("DOMContentLoaded", function () {
			// Grab elements, create settings, etc.
			var video = document.getElementById('video');
			var mediaConfig = { video: true };
			var errBack = function (e) {
				console.log('An error has occurred!', e)
			};

			// Put video listeners into place
			if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
				navigator.mediaDevices.getUserMedia(mediaConfig).then(function (stream) {
					video.src = window.URL.createObjectURL(stream);
					video.play();
				});
			}
			/* Legacy code below! */
			else if (navigator.getUserMedia) { // Standard
				navigator.getUserMedia(mediaConfig, function (stream) {
					video.src = stream;
					video.play();
				}, errBack);
			} else if (navigator.webkitGetUserMedia) { // WebKit-prefixed
				navigator.webkitGetUserMedia(mediaConfig, function (stream) {
					video.src = window.webkitURL.createObjectURL(stream);
					video.play();
				}, errBack);
			} else if (navigator.mozGetUserMedia) { // Mozilla-prefixed
				navigator.mozGetUserMedia(mediaConfig, function (stream) {
					video.src = window.URL.createObjectURL(stream);
					video.play();
				}, errBack);
			}
		});
	</script>
-->
</body>

</html>